terraform {
  required_version = ">= 0.12"


required_providers {
    docker = {
      source = "kreuzwerker/docker"
      version = "2.15.0" # Specify the version you want to use
    }
  }
}
provider "docker" {
    host = "tcp://127.0.0.1:2375"
}

{% for service_name, service_info in services.items() %}
resource "docker_container" "{{ service_name }}" {
  name  = "{{ service_name }}"
  
  # Set the image attribute based on your service configuration
  image = "{{ service_info['image'] }}"  # Set the image dynamically

  # Altre configurazioni per il servizio {{ service_name }}
  
  # Se il servizio espone le porte, aggiungi questa configurazione
  {% if 'ports' in service_info %}
  ports {
    {% for port in service_info['ports'] %}
    internal = {{ port.split(':')[0] }}  # Porta interna del servizio Docker
    external = {{ port.split(':')[1] }}  # Porta esterna del servizio
    {% endfor %}
  }
  {% endif %}
}
{% endfor %}
